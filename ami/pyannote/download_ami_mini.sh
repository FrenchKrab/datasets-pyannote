#!/bin/sh

if [ -z "$1" ]
then
      DLFOLDER="amicorpus"
else
      DLFOLDER="$1/amicorpus"
fi

wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2002a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2002a/audio/ES2002a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2003a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2003a/audio/ES2003a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2004a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2004a/audio/ES2004a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2005a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2005a/audio/ES2005a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2006a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2006a/audio/ES2006a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2007a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2007a/audio/ES2007a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2008a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2008a/audio/ES2008a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2009a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2009a/audio/ES2009a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2010a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2010a/audio/ES2010a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2011a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2011a/audio/ES2011a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2012a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2012a/audio/ES2012a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2013a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2013a/audio/ES2013a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2014a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2014a/audio/ES2014a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2015a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2015a/audio/ES2015a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2016a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2016a/audio/ES2016a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/IS1000a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/IS1000a/audio/IS1000a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/IS1001a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/IS1001a/audio/IS1001a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/IS1003a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/IS1003a/audio/IS1003a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/IS1004a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/IS1004a/audio/IS1004a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/IS1005a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/IS1005a/audio/IS1005a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/IS1006a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/IS1006a/audio/IS1006a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/IS1007a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/IS1007a/audio/IS1007a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3005a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3005a/audio/TS3005a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3006a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3006a/audio/TS3006a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3007a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3007a/audio/TS3007a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3008a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3008a/audio/TS3008a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3009a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3009a/audio/TS3009a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3010a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3010a/audio/TS3010a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3011a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3011a/audio/TS3011a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3012a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3012a/audio/TS3012a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2011a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2011a/audio/ES2011a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/IS1008a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/IS1008a/audio/IS1008a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3004a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3004a/audio/TS3004a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/ES2004a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/ES2004a/audio/ES2004a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/IS1009a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/IS1009a/audio/IS1009a.Mix-Headset.wav
wget --no-verbose --show-progress --continue -P $DLFOLDER/TS3003a/audio http://groups.inf.ed.ac.uk/ami/AMICorpusMirror/amicorpus/TS3003a/audio/TS3003a.Mix-Headset.wav

function fix_wav(){
python - $1 <<END
import wave
import argparse
import io
def normalize_wav(input_file, output_file):
    with wave.open(input_file, "rb") as r_wav, wave.open(output_file, "wb") as w_wav:
        w_wav.setparams(r_wav.getparams())
        w_wav.writeframes(r_wav.readframes(r_wav.getnframes()))
if __name__ == "__main__":
    argparser = argparse.ArgumentParser()
    argparser.add_argument("input", type=str, help="path to file to overwrite")
    args = argparser.parse_args()
    # writing the new wav into a buffer, to prevent overwriting the original
    # file
    buff = io.BytesIO()
    normalize_wav(args.input, buff)
    with open(args.input, "wb") as wav_file:
        wav_file.write(buff.getvalue())
    try:
        from scipy.io.wavfile import read
    except ImportError:
        print("Scipy not installed. "
              "Could not test if the file %s was properly fixed to work "
              "with the scipy wave read function" % args.input)
    else:
        # test-opening the file with scipy
        rate, data = read(args.input)
        print("%s has been properly reformated" % args.input)
END
}

echo "Fixing wav files with invalid chunks"

fix_wav $DLFOLDER/IS1007a/audio/IS1007a.Mix-Headset.wav
fix_wav $DLFOLDER/IS1005a/audio/IS1005a.Mix-Headset.wav
fix_wav $DLFOLDER/IS1004a/audio/IS1004a.Mix-Headset.wav
fix_wav $DLFOLDER/IS1006a/audio/IS1006a.Mix-Headset.wav
fix_wav $DLFOLDER/IS1008a/audio/IS1008a.Mix-Headset.wav
fix_wav $DLFOLDER/IS1009a/audio/IS1009a.Mix-Headset.wav
